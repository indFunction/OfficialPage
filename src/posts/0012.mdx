---
thumbnail: '/media/thumbnails/general/terminal.png'
title: 'Gitでコミットを上書きする'
description: '以前のコミットや歴史を上書きする方法を紹介します。'
date: [2022, 4, 17]
category: 'memo'
keywords: ['Git', 'コミット', 'ログ', 'リセット', 'リベース', '上書き', '改変']
---

　人間であれば失敗を犯します。失敗を犯した瞬間に自覚することもあれば、しばらくしてから気付くこともあるでしょう。もしもそれがGitの世界であれば、幸いにも失敗を上書きする方法が存在します。

　というわけで今回は、私がGitでやらかしたときに使う手段を備忘録として纏めてみました。限定的な説明もなく淡々とコマンドを書き記しているだけなので、詳細が知りたい場合は各自でググってくださいね。それと、これらは個人で運用する（融通やエゴが利く）プロジェクトでの使用を想定しているので、複数人やチームで取り組んでいるプロジェクトでは使わないようにお願いします。大変な事態に陥ると、サングラスを掛けたエージェントがビルから飛び降りるかもしれないので注意しましょう。

## 以前のコミットを上書きする

　前回のコミットを修正して再びコミットする場合や、特定の地点にあるコミットへ遡ってから対象を上書きする（それ以降の変更を対象に纏める）場合は以下の手順で行います。

<br />

1. 特定のコミット（まで）を取り消します。コミットIDについては`git log`で確認しましょう。ここで注意するべき点として、最初のコミットを対象とする場合は`git update-ref`を使用する必要があります。

<Code type='Bash'>
<ST type={['gray_tc']}>直前のコミットを対象とする場合</ST>
&#036; git reset --soft HEAD&#094;

<ST type={['gray_tc']}>特定のコミット（まで）を対象とする場合</ST>
&#036; git reset --soft <ST type={['yellow_tc']}>&lt;コミットID&gt;</ST>

<ST type={['gray_tc']}>最初のコミット（まで）を対象とする場合</ST>
&#036; git update-ref -d HEAD
</Code>

<br />

2. 内容を更新・修正し、ステージングします。今回は`--soft`を指定しているので、上記のコマンドを実行する前に作業が完了している（ステージングされている）場合は次へ進みます。

<br />

3. コミットします。GUIでもCUIでも、コメントを忘れないようにしましょう。

<Code type='Bash'>
&#036; git commit --amend <ST type={['yellow_tc']}>&lt;コメント&gt;</ST>
</Code>

<br />

4. プッシュします。破壊的な操作なので`--force`オプションを付与します。

<Code type='Bash'>
&#036; git push --force origin
</Code>

<br />

5. これでコミットの上書きが完了しました。お疲れ様でした。

## 歴史を改変する

　今までのコミットを取り消すことなく、特定のコードを上書きする（つまり、初めから修正済みのコードが存在した状態で以降のコミットが成されるようにする）場合は以下の手順で行います。

<br />

1. リベースで特定の地点へ戻ります。これもまた、最初のコミットを対象とする場合はコミットIDではなく`--root`を使用する必要があります。

<Code type='Bash'>
<ST type={['gray_tc']}>特定のコミットを対象とする場合</ST>
&#036; git rebase -i <ST type={['yellow_tc']}>&lt;コミットID&gt;</ST>

<ST type={['gray_tc']}>最初のコミットを対象とする場合</ST>
&#036; git rebase -i --root
</Code>

<br />

2. コンソールの場合はコンソールから、Visual Studio CodeなどのIDEを使用している場合は出力されたログファイルで編集・結合したい地点を指定します。後者の場合、単純にテキストを上書きして閉じれば大丈夫です。

<br />

3. 内容を更新・修正し、ステージングします。

<br />

4. コミットします。今回はコメントを付けなくて大丈夫です。

<Code type='Bash'>
&#036; git commit --amend
</Code>

<br />

5. リベースします。コンフリクト（衝突）が起きた場合は、解消してからリベースを再開（再びリベース）しましょう。

<Code type='Bash'>
&#036; git rebase --continue
</Code>

<br />

6. リベースが完了したら強制的にプッシュします。

<Code type='Bash'>
&#036; git push --force origin
</Code>

<br />

7. これで歴史が改変されました。お疲れ様でした。
